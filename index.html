<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Dashboard 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f8fafc; }
        .chart-container { position: relative; height: 350px; width: 100%; }
        .card { background: white; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); padding: 1.5rem; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-slate-800">Financial Dashboard 2026</h1>
                <p class="text-slate-500">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≥‡πÑ‡∏£‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (Embedded Data)</p>
            </div>
            <div class="flex items-center gap-2">
                <label class="cursor-pointer bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-lg font-semibold transition-all shadow-lg shadow-blue-200">
                    üìÇ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà (CSV)
                    <input type="file" id="csvUpload" class="hidden" accept=".csv">
                </label>
            </div>
        </div>

        <!-- Summary Cards -->
        <div id="summaryCards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="card border-l-4 border-blue-500">
                <p class="text-sm text-slate-500 uppercase font-bold">Total Income</p>
                <h2 id="sumIncome" class="text-2xl font-bold text-slate-800">‡∏ø0.00</h2>
            </div>
            <div class="card border-l-4 border-orange-400">
                <p class="text-sm text-slate-500 uppercase font-bold">Total Expenses</p>
                <h2 id="sumExpense" class="text-2xl font-bold text-slate-800">‡∏ø0.00</h2>
            </div>
            <div class="card border-l-4 border-emerald-500">
                <p class="text-sm text-slate-500 uppercase font-bold">Net Profit/Loss</p>
                <h2 id="sumNet" class="text-2xl font-bold text-slate-800">‡∏ø0.00</h2>
            </div>
            <div class="card border-l-4 border-indigo-500">
                <p class="text-sm text-slate-500 uppercase font-bold">Accumulated Profit</p>
                <h2 id="sumAcc" class="text-2xl font-bold text-slate-800">‡∏ø0.00</h2>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- 1. Main Performance Chart -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4 text-slate-700">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏° (Income vs Total Expenses)</h3>
                <div class="chart-container">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>

            <!-- 2. Profit Trend Chart -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4 text-slate-700">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Å‡∏≥‡πÑ‡∏£ (Profit Trends)</h3>
                <div class="chart-container">
                    <canvas id="profitChart"></canvas>
                </div>
            </div>

            <!-- 3. Expense Breakdown Chart -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4 text-slate-700">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ (Expense Breakdown)</h3>
                <div class="chart-container">
                    <canvas id="expenseChart"></canvas>
                </div>
            </div>

            <!-- 4. Late Report Chart -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4 text-slate-700">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡∏™‡∏≤‡∏¢ (Late Report Statistics)</h3>
                <div class="chart-container">
                    <canvas id="lateChart"></canvas>
                </div>
            </div>
        </div>

        <div class="mt-8 text-center text-slate-400 text-sm">
            Dashboard ‡∏ô‡∏µ‡πâ‡∏ù‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Monthly Database.csv ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß | ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå 2026
        </div>
    </div>

    <script>
        // --- ‡∏ù‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ---
        const embeddedCsvData = `Overall,Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec
Total income,7865308.67,,,,,,,,,,,
Cost of goods sold,2645359.98,,,,,,,,,,,
Expense,5220432,,,,,,,,,,,
Net profit & loss,-483.31,,,,,,,,,,,
Accumulated profit,-483.31,,,,,,,,,,,
,,,,,,,,,,,,
Expense Breakdown,Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec
Overtime - Employees,59534.58,,,,,,,,,,,
Telephone Expenses,24509.5,,,,,,,,,,,
Electricity Expenses,18438.75,,,,,,,,,,,
Water Supplies,489.22,,,,,,,,,,,
Stationary Expenses,735.08,,,,,,,,,,,
Seminar & Training,90000,,,,,,,,,,,
Domain & Hosting Expense,68052.08,,,,,,,,,,,
Copy expenses,4108.6,,,,,,,,,,,
Fuel Expenses,47832.51,,,,,,,,,,,
Travel & Transportation-Local,44799.62,,,,,,,,,,,
Loss on Exchange Rate,150582.23,,,,,,,,,,,
,,,,,,,,,,,,
Late report,Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec
Times,24,,,,,,,,,,,
Hours,0.46,,,,,,,,,,,`;

        let charts = {};

        // ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        window.onload = function() {
            loadInitialData();
        };

        function loadInitialData() {
            Papa.parse(embeddedCsvData, {
                header: false,
                skipEmptyLines: true,
                complete: function(results) {
                    processData(results.data);
                }
            });
        }

        function formatCurrency(val) {
            return new Intl.NumberFormat('th-TH', { style: 'currency', currency: 'THB' }).format(val);
        }

        function formatCompactNumber(number) {
            if (Math.abs(number) >= 1000000) {
                return (number / 1000000).toFixed(1) + 'M';
            }
            if (Math.abs(number) >= 1000) {
                return (number / 1000).toFixed(1) + 'k';
            }
            return number.toString();
        }

        document.getElementById('csvUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            Papa.parse(file, {
                header: false,
                skipEmptyLines: true,
                complete: function(results) {
                    processData(results.data);
                }
            });
        });

        function processData(data) {
            const monthIdx = 1; // ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå Jan

            const findValue = (label) => {
                const row = data.find(r => r[0] && r[0].trim() === label);
                if (!row || !row[monthIdx]) return 0;
                return parseFloat(row[monthIdx].toString().replace(/,/g, '')) || 0;
            };

            const income = findValue('Total income');
            const cogs = findValue('Cost of goods sold');
            const expense = findValue('Expense');
            const netProfit = findValue('Net profit & loss');
            const accProfit = findValue('Accumulated profit');

            let lateTimes = 0;
            let lateHours = 0;
            let lateSectionFound = false;
            for (let i = 0; i < data.length; i++) {
                if (data[i][0] && data[i][0].trim() === 'Late report') { lateSectionFound = true; continue; }
                if (lateSectionFound && data[i][0]) {
                    if (data[i][0].trim() === 'Times') lateTimes = parseFloat(data[i][monthIdx]) || 0;
                    if (data[i][0].trim() === 'Hours') lateHours = parseFloat(data[i][monthIdx]) || 0;
                }
            }

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô Card
            document.getElementById('sumIncome').innerText = formatCurrency(income);
            document.getElementById('sumExpense').innerText = formatCurrency(cogs + expense);
            document.getElementById('sumNet').innerText = formatCurrency(netProfit);
            document.getElementById('sumAcc').innerText = formatCurrency(accProfit);

            // ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô
            const netEl = document.getElementById('sumNet');
            if (netProfit < 0) netEl.classList.replace('text-slate-800', 'text-red-600');
            else netEl.classList.replace('text-slate-800', 'text-emerald-600');

            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Expense Breakdown
            let expenseLabels = [];
            let expenseValues = [];
            let inBreakdown = false;

            for (let i = 0; i < data.length; i++) {
                if (data[i][0] === 'Expense Breakdown') { inBreakdown = true; continue; }
                if (inBreakdown) {
                    if (!data[i][0] || data[i][0].trim() === '' || data[i][0] === 'Late report') break;
                    expenseLabels.push(data[i][0]);
                    expenseValues.push(parseFloat(data[i][monthIdx].toString().replace(/,/g, '')) || 0);
                }
            }

            updateCharts(income, cogs, expense, netProfit, accProfit, expenseLabels, expenseValues, lateTimes, lateHours);
        }

        function updateCharts(income, cogs, expense, netProfit, accProfit, expLabels, expValues, lateTimes, lateHours) {
            Object.values(charts).forEach(c => c && c.destroy());

            // 1. Main Chart
            charts.main = new Chart(document.getElementById('mainChart'), {
                type: 'bar',
                data: {
                    labels: ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°'],
                    datasets: [
                        { label: '‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°', data: [income], backgroundColor: '#3b82f6', borderRadius: 6 },
                        { label: '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°', data: [cogs + expense], backgroundColor: '#f97316', borderRadius: 6 }
                    ]
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } },
                    scales: { y: { beginAtZero: true } }
                }
            });

            // 2. Profit Chart
            charts.profit = new Chart(document.getElementById('profitChart'), {
                type: 'line',
                data: {
                    labels: ['Jan'],
                    datasets: [
                        { label: '‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥', data: [netProfit], borderColor: '#10b981', backgroundColor: '#10b981', tension: 0.3, fill: false },
                        { label: '‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∞‡∏™‡∏°', data: [accProfit], borderColor: '#8b5cf6', backgroundColor: '#8b5cf6', borderDash: [5, 5], tension: 0.3 }
                    ]
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } }
                }
            });

            // 3. Expense Breakdown
            charts.expense = new Chart(document.getElementById('expenseChart'), {
                type: 'doughnut',
                data: {
                    labels: expLabels,
                    datasets: [{
                        data: expValues,
                        backgroundColor: ['#6366f1', '#ec4899', '#f59e0b', '#10b981', '#ef4444', '#8b5cf6', '#06b6d4']
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                font: { size: 11 },
                                generateLabels: (chart) => {
                                    const data = chart.data;
                                    return data.labels.map((label, i) => ({
                                        text: `${label} (${formatCompactNumber(data.datasets[0].data[i])})`,
                                        fillStyle: data.datasets[0].backgroundColor[i],
                                        index: i
                                    }));
                                }
                            }
                        }
                    }
                }
            });

            // 4. Late Report Chart
            charts.late = new Chart(document.getElementById('lateChart'), {
                type: 'bar',
                data: {
                    labels: ['Jan'],
                    datasets: [
                        { label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡∏Ñ‡∏£‡∏±‡πâ‡∏á)', data: [lateTimes], backgroundColor: '#f59e0b', yAxisID: 'y' },
                        { label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (‡∏ä‡∏°.)', data: [lateHours], backgroundColor: '#6366f1', yAxisID: 'y1' }
                    ]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        y: { position: 'left', title: { display: true, text: '‡∏Ñ‡∏£‡∏±‡πâ‡∏á' } },
                        y1: { position: 'right', grid: { drawOnChartArea: false }, title: { display: true, text: '‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á' } }
                    }
                }
            });
        }
    </script>
</body>
</html>